<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Protein binding prediction | Andrej Perković </title> <meta name="author" content="Andrej Perković"> <meta name="description" content="Implementation of Capsule Networks for predicting MHC-peptide binding"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://andrejper.github.io/projects/mhc-peptide/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Andrej</span> Perković </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Protein binding prediction</h1> <p class="post-description">Implementation of Capsule Networks for predicting MHC-peptide binding</p> </header> <article> <h3 id="problem-description">Problem description</h3> <p>This project presents the implementation of Capsule Networks (<a href="https://arxiv.org/pdf/1710.09829" rel="external nofollow noopener" target="_blank">CapsNet</a>) for predicting MHC-peptide binding hit. The study covers dataset analysis, methodological explanation, experimental setup, and result evaluation. The advantages of CapsNet are explored through several experiments. This study is the implementation of <a href="https://www.nature.com/articles/s42003-023-04867-2" rel="external nofollow noopener" target="_blank">CapsNet-MHS</a> paper.</p> <p>CapsNet has been proposed as an alternative to traditional Convolutional Neural Networks (CNNs) to better capture spatial hierarchies. This project aims to implement CapsNet for MHC-peptide binding prediction, evaluating its performance against conventional deep learning models.</p> <h3 id="dataset-analysis">Dataset Analysis</h3> <p>The dataset utilized is the <em>NetMHC</em> dataset. It comprises over 3.6 million peptide-allele pairs labeled for MHC class I binding. The distribution of alleles is heavily imbalanced.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/allele_train_distr-480.webp 480w,/assets/img/allele_train_distr-800.webp 800w,/assets/img/allele_train_distr-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/allele_train_distr.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Allele frequency distribution in the training set" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/train_burst-480.webp 480w,/assets/img/train_burst-800.webp 800w,/assets/img/train_burst-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/train_burst.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Hierarchical distribution of alleles" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Left: Allele frequency distribution in the training set. Right: Hierarchical distribution of alleles. </div> <h4 id="challenges">Challenges</h4> <ul> <li>Extreme class imbalance (94.6% non-binding, 5.4% binding)</li> <li>Imbalanced allele frequency and presence of unseen alleles in test set</li> <li>Need for robust embeddings (e.g., using BLOSUM)</li> </ul> <h3 id="network-architecture">Network Architecture</h3> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/architecture-480.webp 480w,/assets/img/architecture-800.webp 800w,/assets/img/architecture-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/architecture.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Network architecture" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Network architecture from reference <a class="citation" href="#kalemati2023capsnet">(Kalemati et al., 2023)</a>. </div> <h3 id="how-did-i-do-it">How did I do it</h3> <p>Capsule Networks represent local features using vectors instead of scalars. Each vector’s norm indicates probability, while the direction captures spatial relationships. Inputs $u_i$ are transformed via matrices $W_{ij}$, producing \(\hat{u}_{j \mid i} = W_{ij} u_i\). Outputs are computed as:</p> \[s_j = \sum_i c_{ij} \hat{u}_{j|i}\] <p>and the final capsule output is:</p> \[v_j = \frac{||s_j||^2}{1 + ||s_j||^2} \cdot \frac{s_j}{||s_j||}\] <h4 id="implementation-details">Implementation Details</h4> <ul> <li>Sigmoid output for binary classification</li> <li>Binary Cross Entropy (BCE) loss used</li> <li>Alleles represented using amino acid sequences</li> <li>Input features encoded using <a href="https://en.wikipedia.org/wiki/BLOSUM" rel="external nofollow noopener" target="_blank">BLOSUM</a> matrices</li> </ul> <h4 id="training">Training</h4> <p>The model was trained using the Adam optimizer with a learning rate of $10^{-6}$. Although the learning rate might appear small, the batch size used is rather big. The training setup included:</p> <ul> <li>BLOSUM45, 62, and 80 embeddings compared</li> <li>Trained for 10 epochs initially, then retrained on the whole training set with BLOSUM62 for 30 epochs</li> <li>Used weighted BCE to compensate for the imbalance</li> <li>Used <code>vast.ai</code> for training due to computational cost</li> <li>Batch size: 512 (train), 1024 (validation)</li> <li>Evaluating with AUC PR, since properly classifying the positive class is more important than being able to distinguish between the classes, which is modeled by AUC ROC</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/loss_area_29-480.webp 480w,/assets/img/loss_area_29-800.webp 800w,/assets/img/loss_area_29-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/loss_area_29.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Training loss for BLOSUM62" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Training and validation loss, AUC Precision-Recall, and Matthew's correlation coefficient curves for BLOSUM62 embedding during training. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/pr_curve_29-480.webp 480w,/assets/img/pr_curve_29-800.webp 800w,/assets/img/pr_curve_29-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/pr_curve_29.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="PR curve for BLOSUM62 after 30 epochs" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Final precision-recall (PR) curve for the model with BLOSUM62 embedding after 30 epochs. </div> <h3 id="results">Results</h3> <table> <thead> <tr> <th>BLOSUM Matrix</th> <th>AUC-ROC</th> </tr> </thead> <tbody> <tr> <td>BLOSUM45</td> <td>0.8407</td> </tr> <tr> <td>BLOSUM62</td> <td>0.8375</td> </tr> <tr> <td>BLOSUM80</td> <td>0.8407</td> </tr> </tbody> </table> <p><em>Table 1:</em> AUC-ROC values on validation set</p> <table> <thead> <tr> <th>Metric</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>AUC PR</td> <td>0.370</td> </tr> <tr> <td>MCC</td> <td>0.333</td> </tr> <tr> <td>Accuracy</td> <td>0.798</td> </tr> <tr> <td>F1-Score</td> <td>0.306</td> </tr> </tbody> </table> <p><em>Table 2:</em> Test set performance metrics for the final model trained for 30 epochs.</p> <table> <thead> <tr> <th>Metric</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>AUC PR</td> <td>0.374</td> </tr> <tr> <td>MCC</td> <td>0.339</td> </tr> <tr> <td>Accuracy</td> <td>0.805</td> </tr> <tr> <td>F1-Score</td> <td>0.314</td> </tr> </tbody> </table> <p><em>Table 3:</em> Validation set performance metrics for the final model trained for 30 epochs.</p> <h4 id="discussion">Discussion</h4> <p>CapsNet-MHC showed strong results on imbalanced data. An alternative NLP-based approach using fastText-like embeddings was tested but was computationally prohibitive due to massive training pairs.</p> <h3 id="conclusion">Conclusion</h3> <p>Capsule Networks effectively capture peptide-allele interactions. While promising, further tuning and training on all folds is necessary to realize full potential. Future efforts should focus on hyperparameter tuning, reconsidering the attention approach and deeper analysis of capsule outputs for the purpose of explainability.</p> </article> <h2>References</h2> <div class="publications"> <h2 class="bibliography">2023</h2> <ol class="bibliography"><li> <div class="row"> <div class="col col-sm-2 abbr"> </div> <div id="kalemati2023capsnet" class="col-sm-8"> <div class="title">CapsNet-MHC predicts peptide-MHC class I binding based on capsule neural networks</div> <div class="author"> Mahmood Kalemati, Saeid Darvishi, and Somayyeh Koohi </div> <div class="periodical"> <em>Communications biology</em>, 2023 </div> <div class="periodical"> </div> <div class="links"> </div> </div> </div> </li></ol> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Andrej Perković. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>